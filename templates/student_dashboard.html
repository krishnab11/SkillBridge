<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Skillbridge</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #4e54c8;
            --primary-light: #8f94fb;
            --secondary-color: #667eea;
            --dark-color: #2d3748;
            --light-color: #f7fafc;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --dark-color: #f7fafc;
            --light-color: #1a202c;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            background-color: #1a202c;
            color: #f7fafc;
        }

        [data-theme="dark"] .content-section,
        [data-theme="dark"] .search-container,
        [data-theme="dark"] .profile-sidebar,
        [data-theme="dark"] .profile-main,
        [data-theme="dark"] .resume-builder-container,
        [data-theme="dark"] .setting-group,
        [data-theme="dark"] .stat-card,
        [data-theme="dark"] .internship-card,
        [data-theme="dark"] .certificate-card {
            background: #2d3748;
            color: #f7fafc;
            border-color: #4a5568;
        }

        [data-theme="dark"] .form-control,
        [data-theme="dark"] .search-input,
        [data-theme="dark"] .filter-select,
        [data-theme="dark"] .tags-input-container {
            background: #4a5568;
            color: #f7fafc;
            border-color: #718096;
        }

        [data-theme="dark"] .section-header {
            border-bottom-color: #4a5568;
        }

        [data-theme="dark"] .applications-table th,
        [data-theme="dark"] .applications-table td {
            border-bottom-color: #4a5568;
        }

        [data-theme="dark"] .header {
            border-bottom-color: #4a5568;
        }

        [data-theme="dark"] .notification-btn,
        [data-theme="dark"] .profile-btn {
            background: #2d3748;
            border-color: #4a5568;
            color: #f7fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            transition: var(--transition);
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
        }

        .sidebar-header {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            background-size: cover;
            background-position: center;
        }

        .user-details h3 {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .user-details p {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .sidebar-nav {
            padding: 0 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 8px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            color: white;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .nav-item i {
            font-size: 1.2rem;
            width: 24px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .notification-btn, .profile-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: white;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .notification-btn:hover, .profile-btn:hover {
            background: var(--light-color);
            transform: translateY(-2px);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Common Component Styles */
        .content-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .section-content {
            padding: 1.5rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #e2e8f0;
            color: var(--dark-color);
        }

        .btn-outline:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* Dashboard Tab Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.applications {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .stat-icon.interviews {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .stat-icon.offers {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .stat-icon.profile {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
        }

        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stat-info p {
            color: #718096;
            font-size: 0.9rem;
        }

        .internships-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .internship-card {
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            transition: var(--transition);
            cursor: pointer;
            background: white;
        }

        .internship-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .internship-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .internship-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .internship-company {
            color: #718096;
            font-size: 0.9rem;
        }

        .internship-type {
            background: #edf2f7;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #4a5568;
        }

        .internship-details {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #718096;
        }

        .internship-details i {
            margin-right: 0.5rem;
        }

        .skills-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .skill-tag {
            background: #e6fffa;
            color: #234e52;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-applied {
            background: #e6fffa;
            color: #234e52;
        }

        .status-interview {
            background: #fef5e7;
            color: #744210;
        }

        .status-offer {
            background: #f0fff4;
            color: #22543d;
        }

        .status-rejected {
            background: #fed7d7;
            color: #742a2a;
        }

        /* Search Tab Styles */
        .search-container {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 500;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .filter-select {
            padding: 0.6rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: inherit;
        }

        /* Applications Tab Styles */
        .applications-table {
            width: 100%;
            border-collapse: collapse;
        }

        .applications-table th,
        .applications-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .applications-table th {
            font-weight: 600;
            color: #718096;
            font-size: 0.9rem;
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #cbd5e0;
        }

        /* Profile Tab Styles */
        .profile-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        .profile-sidebar {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            text-align: center;
            height: fit-content;
        }

        .profile-picture {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #718096;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .profile-picture:hover::after {
            content: 'Change Photo';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .profile-stats {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .profile-main {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .textarea {
            min-height: 100px;
            resize: vertical;
        }

        .tags-input-container {
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 0.8rem;
            background: white;
        }

        .skill-tag-profile {
            background: var(--primary-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.2rem;
        }

        .skill-tag-profile .remove {
            cursor: pointer;
            font-size: 0.7rem;
            margin-left: 0.3rem;
        }

        .social-links-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .file-upload-container {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-message {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }

        .status-success {
            background: #f0fff4;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Certificates Section */
        .certificates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .certificate-card {
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: white;
        }

        .certificate-preview {
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .certificate-info {
            flex: 1;
        }

        .certificate-info h4 {
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .certificate-info p {
            color: #718096;
            font-size: 0.8rem;
        }

        .certificate-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Resume Builder Tab Styles */
        .resume-builder-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
        }

        .resume-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .resume-intro h2 {
            margin-bottom: 0.5rem;
        }

        .resume-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        .ai-suggestions {
            background: #f7fafc;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .suggestion-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .suggestion-item i {
            color: var(--primary-color);
        }

        .resume-templates {
            background: #f7fafc;
            border-radius: var(--border-radius);
            padding: 1.5rem;
        }

        .template-options {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .template-option {
            text-align: center;
            cursor: pointer;
            padding: 1rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .template-option.active {
            background: white;
            box-shadow: var(--shadow);
        }

        .template-preview {
            width: 80px;
            height: 100px;
            background: #e2e8f0;
            margin-bottom: 0.5rem;
            border-radius: 4px;
        }

        .resume-preview-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 2rem;
            min-height: 500px;
        }

        /* Notifications Tab Styles */
        .notifications-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: #f7fafc;
        }

        .notification-item.unread {
            background: #ebf8ff;
            border-left: 4px solid var(--primary-color);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .notification-message {
            color: #718096;
            font-size: 0.9rem;
        }

        .notification-time {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-top: 0.5rem;
        }

        /* Settings Tab Styles */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .setting-group {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark-color);
        }

        /* Unsaved changes indicator */
        .unsaved-changes::before {
            content: "●";
            color: #f56565;
            margin-right: 5px;
            font-size: 12px;
        }

        .profile-progress {
            height: 6px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 3px;
            margin-top: 5px;
            transition: width 0.3s ease;
        }

        .char-count {
            font-size: 0.8rem;
            color: #718096;
            text-align: right;
            display: block;
            margin-top: 5px;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--primary-color);
            flex: 1;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--primary-color);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }
            .main-content {
                margin-left: 250px;
            }
            .profile-container {
                grid-template-columns: 1fr;
            }
            .resume-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .internships-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .social-links-grid {
                grid-template-columns: 1fr;
            }
            
            .certificates-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fa-solid fa-user-graduate"></i>
                    <span>Skillbridge</span>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">
                        <!-- Avatar will be set by JavaScript -->
                    </div>
                    <div class="user-details">
                        <h3 id="userName">Loading...</h3>
                        <p id="userEmail">Loading...</p>
                    </div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-tab="dashboard">
                    <i class="fa-solid fa-gauge"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-tab="search">
                    <i class="fa-solid fa-briefcase"></i>
                    <span>Search Internships</span>
                </a>
                <a href="#" class="nav-item" data-tab="applications">
                    <i class="fa-solid fa-file-lines"></i>
                    <span>My Applications</span>
                </a>
                <a href="#" class="nav-item" data-tab="profile">
                    <i class="fa-solid fa-user-pen"></i>
                    <span>Profile</span>
                </a>
                <a href="#" class="nav-item" data-tab="resume-builder">
                    <i class="fa-solid fa-robot"></i>
                    <span>AI Resume Builder</span>
                </a>
                <a href="#" class="nav-item" data-tab="notifications">
                    <i class="fa-solid fa-bell"></i>
                    <span>Notifications</span>
                </a>
                <a href="#" class="nav-item" data-tab="settings">
                    <i class="fa-solid fa-gear"></i>
                    <span>Settings</span>
                </a>
                <a href="/logout" class="nav-item">
                    <form id="logoutForm" action="/logout" method="get" style="display:inline;">
                        <button type="submit" class="nav-item" style="background:none;border:none;padding:0;margin:0;cursor:pointer;">
                            <i class="fa-solid fa-right-from-bracket"></i>
                            <span>Logout</span>
                        </button>
                    </form>
                    <script>
                    document.getElementById('logoutForm').onsubmit = function(e) {
                        e.preventDefault();
                        fetch('/logout', { method: 'GET', credentials: 'same-origin' })
                          .then(() => { window.location.href = '/'; });
                    };
                    </script>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <div>
                    <button class="mobile-menu-btn">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">Student Dashboard</h1>
                </div>
                <div class="header-actions">
                    <div class="notification-btn" id="notificationBtn">
                        <i class="fa-solid fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </div>
                    <div class="profile-btn" id="profileBtn">
                        <i class="fa-solid fa-user"></i>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon applications">
                            <i class="fa-solid fa-paper-plane"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalApplications">0</h3>
                            <p>Applications Sent</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon interviews">
                            <i class="fa-solid fa-calendar"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="upcomingInterviews">0</h3>
                            <p>Upcoming Interviews</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon offers">
                            <i class="fa-solid fa-trophy"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="jobOffers">0</h3>
                            <p>Job Offers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon profile">
                            <i class="fa-solid fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="profileCompletion">0%</h3>
                            <p>Profile Completion</p>
                        </div>
                    </div>
                </div>

                <!-- Recommended Internships -->
                <div class="content-section">
                    <div class="section-header">
                        <h2>Recommended Internships</h2>
                        <a href="#" data-tab="search">View All</a>
                    </div>
                    <div class="section-content">
                        <div class="internships-grid" id="recommendedInternships">
                            <!-- Recommended internships will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Recent Applications -->
                <div class="content-section">
                    <div class="section-header">
                        <h2>Recent Applications</h2>
                        <a href="#" data-tab="applications">View All</a>
                    </div>
                    <div class="section-content">
                        <div id="recentApplications">
                            <!-- Recent applications will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search Internships Tab -->
            <div id="search-tab" class="tab-content">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search by skills, company, or position...">
                        <button class="btn btn-primary" id="searchBtn">Search</button>
                    </div>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Skills Required</label>
                            <input type="text" class="search-input" id="skillsFilter" placeholder="e.g., Python, React, UI/UX">
                        </div>
                        <div class="filter-group">
                            <label>Internship Period</label>
                            <select class="filter-select" id="periodFilter">
                                <option value="">Any Period</option>
                                <option value="3 months">3 Months</option>
                                <option value="6 months">6 Months</option>
                                <option value="1 year">1 Year</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Location</label>
                            <select class="filter-select" id="locationFilter">
                                <option value="">Any Location</option>
                                <option value="remote">Remote</option>
                                <option value="onsite">On-site</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Type</label>
                            <select class="filter-select" id="typeFilter">
                                <option value="">Any Type</option>
                                <option value="paid">Paid</option>
                                <option value="unpaid">Unpaid</option>
                                <option value="stipend">Stipend</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="internships-grid" id="searchResults">
                    <!-- Search results will be loaded here -->
                </div>
            </div>

            <!-- Applications Tab -->
            <div id="applications-tab" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <h2>Application History</h2>
                        <div class="filter-controls">
                            <select class="filter-select" id="statusFilter">
                                <option value="">All Status</option>
                                <option value="applied">Applied</option>
                                <option value="reviewed">Under Review</option>
                                <option value="interview">Interview</option>
                                <option value="offered">Offered</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                    </div>
                    <div class="section-content">
                        <div class="applications-container">
                            <table class="applications-table">
                                <thead>
                                    <tr>
                                        <th>Company</th>
                                        <th>Position</th>
                                        <th>Applied Date</th>
                                        <th>Status</th>
                                        <th>Last Updated</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="applicationsTable">
                                    <!-- Applications will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content">
                <div class="profile-container">
                    <div class="profile-sidebar">
                        <div class="profile-picture" id="profilePicture">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <h3 id="profileName">Loading...</h3>
                        <p id="profileTitle">Student</p>
                        <p id="profileUniversity">Loading...</p>
                        <button class="btn btn-outline" id="changePhotoBtn">Change Photo</button>
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                        
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="profileCompletionStat">0%</span>
                                <span class="stat-label">Profile Complete</span>
                                <div class="profile-progress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-main">
                        <form id="profileForm">
                            <!-- Basic Information -->
                            <div class="content-section">
                                <div class="section-header">
                                    <h2>Basic Information</h2>
                                </div>
                                <div class="section-content">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label>Full Name</label>
                                            <input type="text" class="form-control" id="fullName" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Email</label>
                                            <input type="email" class="form-control" id="email" required readonly>
                                        </div>
                                        <div class="form-group">
                                            <label>University</label>
                                            <input type="text" class="form-control" id="university" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Major</label>
                                            <input type="text" class="form-control" id="major" required>
                                        </div>
                                        <div class="form-group">
                                            <label>Graduation Year</label>
                                            <input type="number" class="form-control" id="graduationYear" min="2024" max="2030" required>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bio & About -->
                            <div class="content-section">
                                <div class="section-header">
                                    <h2>Bio & About</h2>
                                </div>
                                <div class="section-content">
                                    <div class="form-group">
                                        <label>Bio (Brief introduction)</label>
                                        <textarea class="form-control textarea" id="bio" placeholder="Write a short bio about yourself..." maxlength="160"></textarea>
                                        <small class="char-count">0/160 characters</small>
                                    </div>
                                    <div class="form-group">
                                        <label>About Me</label>
                                        <textarea class="form-control textarea" id="aboutSelf" placeholder="Tell us more about yourself, your interests, and career goals..." rows="4"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Skills -->
                            <div class="content-section">
                                <div class="section-header">
                                    <h2>Skills</h2>
                                </div>
                                <div class="section-content">
                                    <div class="form-group">
                                        <label>Add Skills</label>
                                        <div class="tags-input-container">
                                            <input type="text" class="form-control" id="skillInput" placeholder="Type a skill and press Enter...">
                                            <div class="skills-tags" id="skillsTags"></div>
                                        </div>
                                        <small>Press Enter to add a skill. Click the × to remove.</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Social Links -->
                            <div class="content-section">
                                <div class="section-header">
                                    <h2>Social Links</h2>
                                </div>
                                <div class="section-content">
                                    <div class="social-links-grid">
                                        <div class="form-group">
                                            <label><i class="fa-brands fa-github"></i> GitHub</label>
                                            <input type="url" class="form-control" id="github" placeholder="https://github.com/username">
                                        </div>
                                        <div class="form-group">
                                            <label><i class="fa-brands fa-linkedin"></i> LinkedIn</label>
                                            <input type="url" class="form-control" id="linkedin" placeholder="https://linkedin.com/in/username">
                                        </div>
                                        <div class="form-group">
                                            <label><i class="fa-solid fa-code"></i> LeetCode</label>
                                            <input type="url" class="form-control" id="leetcode" placeholder="https://leetcode.com/username">
                                        </div>
                                        <div class="form-group">
                                            <label><i class="fa-solid fa-laptop-code"></i> HackerRank</label>
                                            <input type="url" class="form-control" id="hackerrank" placeholder="https://hackerrank.com/username">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Resume -->
                            <div class="content-section">
                                <div class="section-header">
                                    <h2>Resume</h2>
                                </div>
                                <div class="section-content">
                                    <div class="form-group">
                                        <label>Upload Resume (Image Only)</label>
                                        <div class="file-upload-container">
                                            <input type="file" class="form-control" id="resumeUpload" accept="image/*">
                                            <button type="button" class="btn btn-primary" id="uploadResumeBtn">Upload Resume</button>
                                        </div>
                                        <small>Supported formats: JPG, PNG, GIF, WEBP (Max: 5MB)</small>
                                        <div id="resumeStatus" class="status-message"></div>
                                        <div id="currentResume" style="margin-top: 1rem;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Certificates Section -->
                            <div class="content-section">
                                <div class="section-header">
                                    <h2>Certificates</h2>
                                </div>
                                <div class="section-content">
                                    <div class="form-group">
                                        <label>Add Certificate</label>
                                        <div class="file-upload-container">
                                            <input type="text" class="form-control" id="certificateName" placeholder="Certificate Name">
                                            <input type="file" class="form-control" id="certificateUpload" accept=".pdf,.jpg,.jpeg,.png">
                                            <button type="button" class="btn btn-primary" id="uploadCertificateBtn">Upload Certificate</button>
                                        </div>
                                        <small>Supported formats: PDF, JPG, PNG (Max: 5MB)</small>
                                    </div>
                                    
                                    <div class="certificates-grid" id="certificatesGrid">
                                        <!-- Certificates will be displayed here -->
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Profile</button>
                                <button type="button" class="btn btn-outline" id="resetBtn">Reset Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- AI Resume Builder Tab -->
            <div id="resume-builder-tab" class="tab-content">
                <div class="resume-builder-container">
                    <div class="resume-header">
                        <div class="resume-intro">
                            <h2>Create Your Professional Resume with AI</h2>
                            <p>Let our AI help you build a standout resume based on your profile and career goals.</p>
                        </div>
                        <div class="resume-actions">
                            <button class="btn btn-primary" id="generateResumeBtn">
                                <i class="fa-solid fa-robot"></i> Generate Resume
                            </button>
                            <button class="btn btn-outline" id="downloadResumeBtn" disabled>
                                <i class="fa-solid fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>

                    <div class="resume-content">
                        <div class="resume-sidebar">
                            <div class="ai-suggestions">
                                <h3>AI Suggestions</h3>
                                <div class="suggestions-list" id="suggestionsList">
                                    <div class="suggestion-item">
                                        <i class="fa-solid fa-lightbulb"></i>
                                        <p>Based on your profile, we suggest emphasizing your technical skills in the experience section.</p>
                                    </div>
                                    <div class="suggestion-item">
                                        <i class="fa-solid fa-lightbulb"></i>
                                        <p>Consider adding quantifiable achievements to make your resume stand out.</p>
                                    </div>
                                    <div class="suggestion-item">
                                        <i class="fa-solid fa-lightbulb"></i>
                                        <p>Use action verbs like "developed", "implemented", "optimized" in your experience section.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="resume-templates">
                                <h3>Choose Template</h3>
                                <div class="template-options">
                                    <div class="template-option active" data-template="modern">
                                        <div class="template-preview modern-preview"></div>
                                        <span>Modern</span>
                                    </div>
                                    <div class="template-option" data-template="professional">
                                        <div class="template-preview professional-preview"></div>
                                        <span>Professional</span>
                                    </div>
                                    <div class="template-option" data-template="creative">
                                        <div class="template-preview creative-preview"></div>
                                        <span>Creative</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="resume-preview-section">
                            <div class="resume-preview-container">
                                <div class="resume-preview" id="resumePreview">
                                    <div class="resume-loading" id="resumeLoading">
                                        <i class="fa-solid fa-spinner fa-spin"></i>
                                        <p>Generate your resume to see the preview</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications-tab" class="tab-content">
                <div class="content-section">
                    <div class="section-header">
                        <h2>Notifications</h2>
                        <button class="btn btn-outline" id="markAllReadBtn">Mark All as Read</button>
                    </div>
                    <div class="section-content">
                        <div class="notifications-list" id="notificationsList">
                            <!-- Notifications will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="settings-grid">
                    <div class="setting-group">
                        <h3>Appearance</h3>
                        <div class="theme-toggle">
                            <span>Dark Mode</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3>Notifications</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="emailNotifications" checked> Email Notifications
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="pushNotifications" checked> Push Notifications
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h3>Privacy</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="profileVisibility" checked> Make Profile Visible to Companies
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
// Global state
let currentUser = null;
let userProfile = null;
let notifications = [];
let currentSkills = [];
let allInternships = [];

// Add this function after the global state
function handleApiError(error, response) {
    console.error('API Error:', error);
    
    if (response && response.status === 401) {
        // Token is invalid or expired
        localStorage.removeItem('token');
        localStorage.removeItem('user_type');
        alert('Your session has expired. Please login again.');
        window.location.href = '/';
        return true;
    }
    return false;
}

// DOM Elements
const tabContents = document.querySelectorAll('.tab-content');
const navItems = document.querySelectorAll('.nav-item[data-tab]');
const pageTitle = document.getElementById('pageTitle');

// Check authentication on page load
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is authenticated
    const token = localStorage.getItem('token');
    const userType = localStorage.getItem('user_type');
    
    if (!token || userType !== 'student') {
        // Redirect to homepage if not authenticated as student
        window.location.href = '/';
        return;
    }
    
    // Load user data and initialize dashboard
    loadUserData();
    setupEventListeners();
    switchTab('dashboard');
    loadDarkModePreference();
});

// Load user data from backend
async function loadUserData() {
    try {
        const token = localStorage.getItem('token');
        
        if (!token) {
            console.error('No token found');
            window.location.href = '/';
            return;
        }

        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };

        // Load profile data
        const response = await fetch('/api/student/profile', { headers });
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }
        
        const data = await response.json();
        
        if (data.success) {
            userProfile = data.profile;
            updateUIWithProfileData();
        } else {
            console.error('Failed to load profile:', data.error);
            // If token is invalid, redirect to login
            if (data.error && data.error.includes('token') || response.status === 401) {
                localStorage.removeItem('token');
                localStorage.removeItem('user_type');
                window.location.href = '/';
            }
        }

        await loadNotifications();
        await loadDashboardData();
        
    } catch (error) {
        console.error('Error loading user data:', error);
        // If there's an error, redirect to login
        localStorage.removeItem('token');
        localStorage.removeItem('user_type');
        window.location.href = '/';
    }
}

// Update UI with profile data
function updateUIWithProfileData() {
    if (userProfile) {
        // Update user info in sidebar
        document.getElementById('userName').textContent = userProfile.full_name || 'Student User';
        document.getElementById('userEmail').textContent = userProfile.email;
        
        // Update profile tab
        document.getElementById('profileName').textContent = userProfile.full_name || 'Student User';
        document.getElementById('profileTitle').textContent = userProfile.course || 'Student';
        document.getElementById('profileUniversity').textContent = userProfile.college || 'University';
        
        // Update form fields
        document.getElementById('fullName').value = userProfile.full_name || '';
        document.getElementById('email').value = userProfile.email || '';
        document.getElementById('university').value = userProfile.college || '';
        document.getElementById('major').value = userProfile.course || '';
        document.getElementById('graduationYear').value = userProfile.graduation_year || '';
        document.getElementById('bio').value = userProfile.bio || '';
        document.getElementById('aboutSelf').value = userProfile.about_self || '';
        
        // Update skills - ensure it's an array
        if (userProfile.skills) {
            if (Array.isArray(userProfile.skills)) {
                currentSkills = userProfile.skills;
            } else if (typeof userProfile.skills === 'string') {
                currentSkills = userProfile.skills.split(',').map(skill => skill.trim()).filter(skill => skill);
            } else {
                currentSkills = [];
            }
        } else {
            currentSkills = [];
        }
        updateSkillsDisplay();
        
        // Update social links
        if (userProfile.social_links) {
            document.getElementById('github').value = userProfile.social_links.github || '';
            document.getElementById('linkedin').value = userProfile.social_links.linkedin || '';
            document.getElementById('leetcode').value = userProfile.social_links.leetcode || '';
            document.getElementById('hackerrank').value = userProfile.social_links.hackerrank || '';
        }
        
        // Update profile picture
        if (userProfile.profile_picture) {
            document.getElementById('userAvatar').style.backgroundImage = `url(${userProfile.profile_picture})`;
            document.getElementById('userAvatar').textContent = '';
            document.getElementById('profilePicture').style.backgroundImage = `url(${userProfile.profile_picture})`;
            document.getElementById('profilePicture').innerHTML = '';
        } else {
            const initials = (userProfile.full_name || 'SU').split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
            document.getElementById('userAvatar').style.backgroundImage = 'none';
            document.getElementById('profilePicture').innerHTML = '<i class="fa-solid fa-user"></i>';
            document.getElementById('profilePicture').style.backgroundImage = 'none';
        }

        // Update resume display
        if (userProfile.resume_url) {
            document.getElementById('currentResume').innerHTML = `
                <p><strong>Current Resume:</strong> <a href="${userProfile.resume_url}" target="_blank">View Resume</a></p>
            `;
        } else {
            document.getElementById('currentResume').innerHTML = '';
        }

        // Load certificates
        loadCertificates();
        
        // Calculate profile completion
        calculateProfileCompletion();
        
        // Remove unsaved changes indicator
        document.getElementById('profileForm').classList.remove('unsaved-changes');
    }
}

// Setup event listeners
function setupEventListeners() {
    // Tab navigation
    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const tab = item.getAttribute('data-tab');
            switchTab(tab);
        });
    });

    // Mobile menu
    document.querySelector('.mobile-menu-btn').addEventListener('click', () => {
        document.querySelector('.sidebar').classList.toggle('active');
    });

    // Notification button
    document.getElementById('notificationBtn').addEventListener('click', () => {
        switchTab('notifications');
    });

    // Profile button
    document.getElementById('profileBtn').addEventListener('click', () => {
        switchTab('profile');
    });

    // Search functionality
    document.getElementById('searchBtn').addEventListener('click', performSearch);
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') performSearch();
    });

    // Profile form
    document.getElementById('profileForm').addEventListener('submit', saveProfile);

    // Skills input
    document.getElementById('skillInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            const skill = e.target.value.trim();
            if (skill) {
                addSkill(skill);
                e.target.value = '';
            }
        }
    });

    // Photo upload
    document.getElementById('changePhotoBtn').addEventListener('click', () => {
        document.getElementById('photoUpload').click();
    });

    document.getElementById('photoUpload').addEventListener('change', handlePhotoUpload);

    // Resume upload
    document.getElementById('uploadResumeBtn').addEventListener('click', handleResumeUpload);

    // Certificate upload
    document.getElementById('uploadCertificateBtn').addEventListener('click', uploadCertificate);

    // Settings
    document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode);

    // Mark all notifications as read
    document.getElementById('markAllReadBtn').addEventListener('click', markAllNotificationsAsRead);

    // Resume builder
    document.getElementById('generateResumeBtn').addEventListener('click', generateResume);
    document.getElementById('downloadResumeBtn').addEventListener('click', downloadResume);

    // Template selection
    document.querySelectorAll('.template-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.template-option').forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Bio character count
    document.getElementById('bio').addEventListener('input', function() {
        const count = this.value.length;
        document.querySelector('.char-count').textContent = `${count}/160 characters`;
        document.getElementById('profileForm').classList.add('unsaved-changes');
    });

    // Reset form button
    document.getElementById('resetBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to reset all changes?')) {
            updateUIWithProfileData(); // Reload original data
            document.getElementById('profileForm').classList.remove('unsaved-changes');
        }
    });

    // Add input event listeners to mark form as dirty
    const formInputs = document.querySelectorAll('#profileForm input, #profileForm textarea, #profileForm select');
    formInputs.forEach(input => {
        input.addEventListener('input', function() {
            document.getElementById('profileForm').classList.add('unsaved-changes');
        });
    });
}

// Switch between tabs
function switchTab(tabName) {
    // Update active nav item
    navItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-tab') === tabName) {
            item.classList.add('active');
        }
    });

    // Show active tab content
    tabContents.forEach(tab => {
        tab.classList.remove('active');
        if (tab.id === `${tabName}-tab`) {
            tab.classList.add('active');
        }
    });

    // Update page title
    const tabTitles = {
        'dashboard': 'Student Dashboard',
        'search': 'Search Internships',
        'applications': 'My Applications',
        'profile': 'Profile Management',
        'resume-builder': 'AI Resume Builder',
        'notifications': 'Notifications',
        'settings': 'Settings'
    };
    pageTitle.textContent = tabTitles[tabName] || 'Student Dashboard';

    // Load tab-specific data
    switch (tabName) {
        case 'search':
            loadInternships();
            break;
        case 'applications':
            loadApplications();
            break;
        case 'notifications':
            loadNotifications();
            break;
        case 'profile':
            calculateProfileCompletion();
            loadCertificates();
            break;
    }
}

// Load dashboard data
async function loadDashboardData() {
    try {
        const token = localStorage.getItem('token');
        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };

        const appsResponse = await fetch('/api/applications', { headers });
        if (!appsResponse.ok) {
            if (handleApiError(null, appsResponse)) return;
        }
        const appsData = await appsResponse.json();
        
        if (appsData.success) {
            const applications = appsData.applications;
            document.getElementById('totalApplications').textContent = applications.length;
            
            const interviews = applications.filter(app => app.status === 'interview').length;
            const offers = applications.filter(app => app.status === 'offered').length;
            
            document.getElementById('upcomingInterviews').textContent = interviews;
            document.getElementById('jobOffers').textContent = offers;
            
            displayRecentApplications(applications.slice(0, 5));
        }

        await loadRecommendedInternships();

    } catch (error) {
        console.error('Error loading dashboard data:', error);
    }
}

// Calculate profile completion percentage - UPDATED FUNCTION
function calculateProfileCompletion() {
    let completionScore = 0;
    let completedFields = 0;
    let totalFields = 0;

    if (userProfile) {
        // Basic Information (40 points)
        if (userProfile.full_name && userProfile.full_name.trim()) {
            completionScore += 10;
            completedFields++;
        }
        totalFields++;
        
        if (userProfile.college && userProfile.college.trim()) {
            completionScore += 10;
            completedFields++;
        }
        totalFields++;
        
        if (userProfile.course && userProfile.course.trim()) {
            completionScore += 10;
            completedFields++;
        }
        totalFields++;
        
        if (userProfile.graduation_year) {
            completionScore += 10;
            completedFields++;
        }
        totalFields++;

        // Bio & About (15 points)
        if (userProfile.bio && userProfile.bio.trim()) {
            completionScore += 7;
            completedFields++;
        }
        totalFields++;
        
        if (userProfile.about_self && userProfile.about_self.trim()) {
            completionScore += 8;
            completedFields++;
        }
        totalFields++;

        // Skills (15 points)
        if (userProfile.skills && userProfile.skills.length > 0) {
            completionScore += 15;
            completedFields++;
        }
        totalFields++;

        // Social Links (10 points) - at least one social link
        const socialLinks = userProfile.social_links || {};
        const hasSocialLinks = socialLinks.github || socialLinks.linkedin || socialLinks.leetcode || socialLinks.hackerrank;
        if (hasSocialLinks) {
            completionScore += 10;
            completedFields++;
        }
        totalFields++;

        // Resume (10 points)
        if (userProfile.resume_url) {
            completionScore += 10;
            completedFields++;
        }
        totalFields++;

        // Profile Picture (5 points)
        if (userProfile.profile_picture) {
            completionScore += 5;
            completedFields++;
        }
        totalFields++;

        // Certificates (5 points)
        if (userProfile.certificates && userProfile.certificates.length > 0) {
            completionScore += 5;
            completedFields++;
        }
        totalFields++;
    }

    // Update UI
    document.getElementById('profileCompletion').textContent = completionScore + '%';
    document.getElementById('profileCompletionStat').textContent = completionScore + '%';
    
    // Update progress bar
    const progressBar = document.querySelector('.profile-progress');
    if (progressBar) {
        progressBar.style.width = completionScore + '%';
    }

    console.log(`Profile Completion: ${completionScore}% (${completedFields}/${totalFields} fields completed)`);
}

// Load and display recommended internships
async function loadRecommendedInternships() {
    try {
        const token = localStorage.getItem('token');
        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };

        const response = await fetch('/api/internships?limit=3', { headers });
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }
        const data = await response.json();
        
        if (data.success) {
            displayInternships(data.internships, 'recommendedInternships');
        }
    } catch (error) {
        console.error('Error loading recommended internships:', error);
    }
}

// Load all internships for search
async function loadInternships(filters = {}) {
    try {
        const token = localStorage.getItem('token');
        const queryParams = new URLSearchParams(filters).toString();
        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };

        const response = await fetch(`/api/internships?${queryParams}`, { headers });
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }
        const data = await response.json();
        
        if (data.success) {
            allInternships = data.internships;
            displayInternships(data.internships, 'searchResults');
        }
    } catch (error) {
        console.error('Error loading internships:', error);
    }
}

// Display internships in grid
function displayInternships(internships, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';

    if (internships.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fa-solid fa-search"></i>
                <h3>No Internships Found</h3>
                <p>Try adjusting your search criteria or filters</p>
            </div>
        `;
        return;
    }

    internships.forEach(internship => {
        const card = document.createElement('div');
        card.className = 'internship-card';
        card.innerHTML = `
            <div class="internship-header">
                <div>
                    <div class="internship-title">${internship.title}</div>
                    <div class="internship-company">${internship.company_name}</div>
                </div>
                <span class="internship-type">${internship.type}</span>
            </div>
            <div class="internship-details">
                <div><i class="fa-solid fa-location-dot"></i> ${internship.location}</div>
                <div><i class="fa-solid fa-money-bill"></i> ${internship.salary}</div>
                <div><i class="fa-solid fa-clock"></i> ${internship.duration}</div>
            </div>
            <div class="skills-tags">
                ${internship.skills_required.map(skill => 
                    `<span class="skill-tag">${skill}</span>`
                ).join('')}
            </div>
            <div class="internship-description">
                <p>${internship.description.substring(0, 150)}...</p>
            </div>
            <div class="internship-actions">
                <button class="btn btn-primary view-details-btn" data-id="${internship.id}">View Details</button>
                <button class="btn btn-outline apply-btn" data-id="${internship.id}">Apply Now</button>
            </div>
        `;
        container.appendChild(card);
    });

    // Add event listeners
    document.querySelectorAll('.view-details-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const internshipId = e.target.getAttribute('data-id');
            showInternshipDetails(internshipId);
        });
    });

    document.querySelectorAll('.apply-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const internshipId = e.target.getAttribute('data-id');
            applyToInternship(internshipId);
        });
    });
}

// Show internship details in modal
function showInternshipDetails(internshipId) {
    // Find internship data
    const internship = allInternships.find(intern => intern.id == internshipId);
    if (!internship) return;

    // Create modal HTML
    const modalHTML = `
        <div class="modal-overlay active" id="internshipModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>${internship.title}</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="company-info">
                        <h3>${internship.company_name}</h3>
                        <div class="internship-meta">
                            <span><i class="fa-solid fa-location-dot"></i> ${internship.location}</span>
                            <span><i class="fa-solid fa-money-bill"></i> ${internship.salary}</span>
                            <span><i class="fa-solid fa-clock"></i> ${internship.duration}</span>
                            <span><i class="fa-solid fa-code"></i> ${internship.type}</span>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h4>Description</h4>
                        <p>${internship.description}</p>
                    </div>
                    
                    <div class="section">
                        <h4>Requirements</h4>
                        <p>${internship.requirements}</p>
                    </div>
                    
                    <div class="section">
                        <h4>Skills Required</h4>
                        <div class="skills-tags">
                            ${internship.skills_required.map(skill => 
                                `<span class="skill-tag">${skill}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="section">
                        <h4>Application Process</h4>
                        <ol>
                            <li>Submit your application through this platform</li>
                            <li>Initial screening and resume review</li>
                            <li>Technical interview (if shortlisted)</li>
                            <li>Final interview with hiring manager</li>
                            <li>Offer and onboarding</li>
                        </ol>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="closeModal">Close</button>
                    <button class="btn btn-primary" id="applyFromModal" data-id="${internship.id}">Apply Now</button>
                </div>
            </div>
        </div>
    `;

    // Add modal to page
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    // Add event listeners for modal
    document.getElementById('closeModal').addEventListener('click', closeInternshipModal);
    document.querySelector('.modal-close').addEventListener('click', closeInternshipModal);
    document.getElementById('applyFromModal').addEventListener('click', (e) => {
        const internshipId = e.target.getAttribute('data-id');
        closeInternshipModal();
        applyToInternship(internshipId);
    });

    // Close modal when clicking overlay
    document.getElementById('internshipModal').addEventListener('click', (e) => {
        if (e.target.id === 'internshipModal') {
            closeInternshipModal();
        }
    });
}

function closeInternshipModal() {
    const modal = document.getElementById('internshipModal');
    if (modal) {
        modal.remove();
    }
}

// Enhanced apply function
async function applyToInternship(internshipId) {
    if (!confirm('Are you sure you want to apply for this internship?')) {
        return;
    }

    try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/applications', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                internship_id: parseInt(internshipId),
                cover_letter: 'I am excited to apply for this internship position. My skills and experience make me a strong candidate for this role.'
            })
        });

        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        const data = await response.json();
        
        if (data.success) {
            alert('Application submitted successfully!');
            // Update dashboard stats
            loadDashboardData();
        } else {
            alert(data.error || 'Failed to submit application. Please try again.');
        }
    } catch (error) {
        console.error('Error applying to internship:', error);
        alert('Failed to submit application. Please try again.');
    }
}

// Perform search with filters
function performSearch() {
    const filters = {
        search: document.getElementById('searchInput').value,
        skills: document.getElementById('skillsFilter').value,
        type: document.getElementById('typeFilter').value,
        location: document.getElementById('locationFilter').value
    };

    loadInternships(filters);
}

// Load applications
async function loadApplications() {
    try {
        const token = localStorage.getItem('token');
        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };

        const response = await fetch('/api/applications', { headers });
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }
        const data = await response.json();
        
        if (data.success) {
            displayApplicationsTable(data.applications);
        } else {
            showEmptyState();
        }
    } catch (error) {
        console.error('Error loading applications:', error);
        showEmptyState();
    }
}

// Display applications in table
function displayApplicationsTable(applications) {
    const tbody = document.getElementById('applicationsTable');
    
    if (applications.length === 0) {
        showEmptyState();
        return;
    }

    tbody.innerHTML = '';

    applications.forEach(app => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <strong>${app.company_name}</strong>
            </td>
            <td>${app.internship_title}</td>
            <td>${new Date(app.applied_date).toLocaleDateString()}</td>
            <td>
                <span class="status-badge status-${app.status}">${app.status}</span>
            </td>
            <td>${new Date(app.updated_at).toLocaleDateString()}</td>
            <td>
                <div class="application-actions">
                    <button class="btn btn-outline view-btn" data-id="${app.id}">View</button>
                    <button class="btn btn-outline withdraw-btn" data-id="${app.id}">Withdraw</button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// Show empty state for applications
function showEmptyState() {
    const tbody = document.getElementById('applicationsTable');
    tbody.innerHTML = `
        <tr>
            <td colspan="6">
                <div class="empty-state">
                    <i class="fa-solid fa-file-lines"></i>
                    <h3>No Applications Yet</h3>
                    <p>Start applying to internships to see your applications here.</p>
                    <a href="#" data-tab="search" class="btn btn-primary">Browse Internships</a>
                </div>
            </td>
        </tr>
    `;
}

// Display recent applications on dashboard
function displayRecentApplications(applications) {
    const container = document.getElementById('recentApplications');
    
    if (applications.length === 0) {
        container.innerHTML = '<p>No applications yet. Start applying to internships!</p>';
        return;
    }

    let html = '<table style="width: 100%; border-collapse: collapse;"><thead><tr><th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Company</th><th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Position</th><th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Date</th><th style="padding: 1rem; text-align: left; border-bottom: 1px solid #e2e8f0;">Status</th></tr></thead><tbody>';
    
    applications.forEach(app => {
        html += `
            <tr>
                <td style="padding: 1rem; border-bottom: 1px solid #e2e8f0;">${app.company_name}</td>
                <td style="padding: 1rem; border-bottom: 1px solid #e2e8f0;">${app.internship_title}</td>
                <td style="padding: 1rem; border-bottom: 1px solid #e2e8f0;">${new Date(app.applied_date).toLocaleDateString()}</td>
                <td style="padding: 1rem; border-bottom: 1px solid #e2e8f0;"><span class="status-badge status-${app.status}">${app.status}</span></td>
            </tr>
        `;
    });
    
    html += '</tbody></table>';
    container.innerHTML = html;
}

// Add skill to profile
function addSkill(skill) {
    const trimmedSkill = skill.trim();
    if (trimmedSkill && !currentSkills.includes(trimmedSkill)) {
        currentSkills.push(trimmedSkill);
        updateSkillsDisplay();
        document.getElementById('profileForm').classList.add('unsaved-changes');
    }
}

// Remove skill from profile
function removeSkill(skill) {
    currentSkills = currentSkills.filter(s => s !== skill);
    updateSkillsDisplay();
    document.getElementById('profileForm').classList.add('unsaved-changes');
}

// Update skills display
function updateSkillsDisplay() {
    const container = document.getElementById('skillsTags');
    container.innerHTML = '';
    
    currentSkills.forEach(skill => {
        const tag = document.createElement('span');
        tag.className = 'skill-tag-profile';
        tag.innerHTML = `
            ${skill}
            <span class="remove" onclick="removeSkill('${skill.replace(/'/g, "\\'")}')">×</span>
        `;
        container.appendChild(tag);
    });
}

// Save profile - UPDATED FUNCTION
async function saveProfile(e) {
    e.preventDefault();
    
    try {
        const token = localStorage.getItem('token');
        
        // Prepare profile data
        const profileData = {
            full_name: document.getElementById('fullName').value,
            college: document.getElementById('university').value,
            course: document.getElementById('major').value,
            graduation_year: parseInt(document.getElementById('graduationYear').value),
            bio: document.getElementById('bio').value,
            about_self: document.getElementById('aboutSelf').value,
            skills: currentSkills, // This should be the array of skills
            social_links: {
                github: document.getElementById('github').value,
                linkedin: document.getElementById('linkedin').value,
                leetcode: document.getElementById('leetcode').value,
                hackerrank: document.getElementById('hackerrank').value
            }
        };

        console.log('Sending profile data:', profileData); // Debug log

        const response = await fetch('/api/student/profile', {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(profileData)
        });

        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        const data = await response.json();
        
        if (data.success) {
            alert('Profile saved successfully!');
            
            // Update local userProfile with the returned data
            if (data.profile) {
                userProfile = { ...userProfile, ...data.profile };
                updateUIWithProfileData();
                calculateProfileCompletion();
            }
            
            // Remove unsaved changes indicator
            document.getElementById('profileForm').classList.remove('unsaved-changes');
        } else {
            alert('Failed to save profile: ' + data.error);
        }
    } catch (error) {
        console.error('Error saving profile:', error);
        alert('Failed to save profile. Please try again.');
    }
}

// Handle photo upload
async function handlePhotoUpload(e) {
    const file = e.target.files[0];
    if (file) {
        const formData = new FormData();
        formData.append('file', file);

        try {
            const token = localStorage.getItem('token');
            const response = await fetch('/api/student/upload-profile-picture', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                },
                body: formData
            });

            if (!response.ok) {
                if (handleApiError(null, response)) return;
            }

            const data = await response.json();
            
            if (data.success) {
                document.getElementById('userAvatar').style.backgroundImage = `url(${data.image_url})`;
                document.getElementById('userAvatar').textContent = '';
                document.getElementById('profilePicture').style.backgroundImage = `url(${data.image_url})`;
                document.getElementById('profilePicture').innerHTML = '';
                alert('Profile picture updated successfully!');
                calculateProfileCompletion();
            } else {
                alert('Failed to upload profile picture: ' + data.error);
            }
        } catch (error) {
            console.error('Error uploading profile picture:', error);
            alert('Failed to upload profile picture. Please try again.');
        }
    }
}

// Handle resume upload
async function handleResumeUpload() {
    const fileInput = document.getElementById('resumeUpload');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Please select a resume file (image only)');
        return;
    }

    // Check if the file is an image
    if (!file.type.startsWith('image/')) {
        alert('Only image files (JPG, PNG, GIF, etc.) are allowed for the resume.');
        fileInput.value = ''; // Clear the input
        return;
    }
    const formData = new FormData();
    formData.append('file', file);

    try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/student/upload-resume', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                },
            body: formData
        });

        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        const data = await response.json();
        
        if (data.success) {
            document.getElementById('resumeStatus').innerHTML = '<p class="status-success">Resume uploaded successfully!</p>';
            document.getElementById('currentResume').innerHTML = `
                <p><strong>Current Resume:</strong> <a href="${data.resume_url}" target="_blank">View Resume</a></p>
            `;
            calculateProfileCompletion();
        } else {
            document.getElementById('resumeStatus').innerHTML = `<p style="color: var(--danger-color);">${data.error}</p>`;
        }
    } catch (error) {
        console.error('Error uploading resume:', error);
        document.getElementById('resumeStatus').innerHTML = '<p style="color: var(--danger-color);">Failed to upload resume. Please try again.</p>';
    }
}

// Load certificates
function loadCertificates() {
    const certificates = userProfile?.certificates || [];
    const container = document.getElementById('certificatesGrid');
    
    if (certificates.length === 0) {
        container.innerHTML = '<p>No certificates uploaded yet.</p>';
        return;
    }
    
    container.innerHTML = certificates.map(cert => `
        <div class="certificate-card">
            <div class="certificate-preview">
                <i class="fa-solid fa-file-certificate"></i>
            </div>
            <div class="certificate-info">
                <h4>${cert.name}</h4>
                <p>Uploaded: ${new Date(cert.uploaded_at).toLocaleDateString()}</p>
            </div>
            <div class="certificate-actions">
                <a href="${cert.url}" target="_blank" class="btn btn-outline">View</a>
                <button class="btn btn-outline delete-certificate" data-id="${cert.id}">Delete</button>
            </div>
        </div>
    `).join('');
    
    // Add event listeners for delete buttons
    document.querySelectorAll('.delete-certificate').forEach(btn => {
        btn.addEventListener('click', async (e) => {
            const certificateId = e.target.getAttribute('data-id');
            await deleteCertificate(certificateId);
        });
    });
}

// Upload certificate
async function uploadCertificate() {
    const fileInput = document.getElementById('certificateUpload');
    const nameInput = document.getElementById('certificateName');
    const file = fileInput.files[0];
    const name = nameInput.value.trim();
    
    if (!name) {
        alert('Please enter a certificate name');
        return;
    }
    
    if (!file) {
        alert('Please select a certificate file');
        return;
    }
    
    const formData = new FormData();
    formData.append('file', file);
    formData.append('name', name);
    
    try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/student/upload-certificate', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
            },
            body: formData
        });
        
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        const data = await response.json();
        
        if (data.success) {
            alert('Certificate uploaded successfully!');
            // Reload profile data
            await loadUserData();
            loadCertificates();
            calculateProfileCompletion();
            // Clear inputs
            fileInput.value = '';
            nameInput.value = '';
        } else {
            alert('Failed to upload certificate: ' + data.error);
        }
    } catch (error) {
        console.error('Error uploading certificate:', error);
        alert('Failed to upload certificate. Please try again.');
    }
}

// Delete certificate
async function deleteCertificate(certificateId) {
    if (!confirm('Are you sure you want to delete this certificate?')) {
        return;
    }
    
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`/api/student/certificates/${certificateId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });
        
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        const data = await response.json();
        
        if (data.success) {
            alert('Certificate deleted successfully!');
            // Reload profile data
            await loadUserData();
            loadCertificates();
            calculateProfileCompletion();
        } else {
            alert('Failed to delete certificate: ' + data.error);
        }
    } catch (error) {
        console.error('Error deleting certificate:', error);
        alert('Failed to delete certificate. Please try again.');
    }
}

// Load notifications
async function loadNotifications() {
    try {
        const token = localStorage.getItem('token');
        const headers = {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        };

        const response = await fetch('/api/notifications', { headers });
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }
        const data = await response.json();
        
        if (data.success) {
            notifications = data.notifications;
            displayNotifications();
            updateNotificationBadge();
        }
    } catch (error) {
        console.error('Error loading notifications:', error);
    }
}

// Display notifications
function displayNotifications() {
    const container = document.getElementById('notificationsList');
    container.innerHTML = '';

    if (notifications.length === 0) {
        container.innerHTML = '<p>No notifications yet.</p>';
        return;
    }

    notifications.forEach(notification => {
        const item = document.createElement('div');
        item.className = `notification-item ${notification.is_read ? '' : 'unread'}`;
        item.innerHTML = `
            <div class="notification-title">${notification.title}</div>
            <div class="notification-message">${notification.message}</div>
            <div class="notification-time">${new Date(notification.created_at).toLocaleString()}</div>
        `;
        
        item.addEventListener('click', () => {
            markNotificationAsRead(notification.id);
        });
        
        container.appendChild(item);
    });
}

// Update notification badge
function updateNotificationBadge() {
    const unreadCount = notifications.filter(n => !n.is_read).length;
    document.getElementById('notificationCount').textContent = unreadCount;
}

// Mark notification as read
async function markNotificationAsRead(notificationId) {
    try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/notifications/mark-read', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ notification_id: notificationId })
        });

        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        if (response.ok) {
            // Update local state
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.is_read = true;
            }
            displayNotifications();
            updateNotificationBadge();
        }
    } catch (error) {
        console.error('Error marking notification as read:', error);
    }
}

// Mark all notifications as read
async function markAllNotificationsAsRead() {
    try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/notifications/mark-read', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
                },
            body: JSON.stringify({ notification_id: 'all' })
        });

        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        if (response.ok) {
            // Update local state
            notifications.forEach(n => n.is_read = true);
            displayNotifications();
            updateNotificationBadge();
        }
    } catch (error) {
        console.error('Error marking all notifications as read:', error);
    }
}

// Toggle dark mode
function toggleDarkMode() {
    const isDarkMode = document.getElementById('darkModeToggle').checked;
    document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
    
    // Save preference to localStorage
    localStorage.setItem('darkMode', isDarkMode);
}

// Load dark mode preference
function loadDarkModePreference() {
    const darkMode = localStorage.getItem('darkMode') === 'true';
    document.getElementById('darkModeToggle').checked = darkMode;
    if (darkMode) {
        document.body.setAttribute('data-theme', 'dark');
    }
}

// Generate resume with AI
async function generateResume() {
    const resumePreview = document.getElementById('resumePreview');
    const loading = document.getElementById('resumeLoading');
    
    // Show loading state
    loading.style.display = 'block';
    resumePreview.innerHTML = '';
    
    try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/generate-resume', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            }
        });
        
        if (!response.ok) {
            if (handleApiError(null, response)) return;
        }

        const data = await response.json();
        
        if (data.success) {
            loading.style.display = 'none';
            
            // Generate sample resume content
            const resume = data.resume;
            resumePreview.innerHTML = `
                <div class="resume-template">
                    <div class="resume-header">
                        <h1>${resume.personal_info.name}</h1>
                        <p>${resume.education.degree} | ${resume.education.university} | Expected ${resume.education.graduation_year}</p>
                        <div class="contact-info">
                            <span>${resume.personal_info.email}</span>
                            <span>|</span>
                            <span>Phone: ${resume.personal_info.phone}</span>
                            <span>|</span>
                            <span>LinkedIn: ${resume.personal_info.linkedin}</span>
                            <span>|</span>
                            <span>GitHub: ${resume.personal_info.github}</span>
                        </div>
                    </div>
                    
                    <div class="resume-section">
                        <h2>Summary</h2>
                        <p>${resume.summary}</p>
                    </div>
                    
                    <div class="resume-section">
                        <h2>Skills</h2>
                        <div class="skills-list">
                            ${resume.skills.map(skill => `<span class="resume-skill">${skill}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="resume-section">
                        <h2>Education</h2>
                        <div class="education-item">
                            <h3>${resume.education.university}</h3>
                            <p>${resume.education.degree} | Expected Graduation: ${resume.education.graduation_year}</p>
                        </div>
                    </div>
                    
                    <div class="resume-section">
                        <h2>Projects</h2>
                        ${resume.projects.map(project => `
                            <div class="project-item">
                                <h3>${project.title}</h3>
                                <p>${project.description}</p>
                                <div class="project-technologies">
                                    ${project.technologies.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Enable download button
            document.getElementById('downloadResumeBtn').disabled = false;
        } else {
            alert('Failed to generate resume: ' + data.error);
        }
    } catch (error) {
        console.error('Error generating resume:', error);
        alert('Failed to generate resume. Please try again.');
    }
}

// Download resume
function downloadResume() {
    // Create a simple PDF download (in a real app, you'd use a PDF generation library)
    const resumeContent = document.getElementById('resumePreview').innerText;
    const blob = new Blob([resumeContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${userProfile.full_name || 'resume'}_resume.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('Resume downloaded as text file. In a real application, this would be a PDF.');
}

// Initialize sample data when dashboard loads
document.addEventListener('DOMContentLoaded', function() {
    // Create sample internships if needed
    setTimeout(() => {
        fetch('/api/create-sample-internships', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Sample internships initialized');
                }
            })
            .catch(error => console.error('Error initializing sample data:', error));
    }, 1000);
});
    </script>
</body>
</html>